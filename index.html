<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logtime 42</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="dark">
  <div class="toggle-theme" onclick="toggleTheme()">🌙</div>

  <h2>🔎 Logtime 42 🔎</h2>

  <div class="favorites">
	<strong>⭐ Favoris :</strong><br>
	<select onchange="selectLogin(this.value)">
	  <option value="">-- Choisir un favori --</option>
	  <option value="pledieu">pledieu</option>
	  <option value="lcosson">lcosson</option>
	  <option value="abouclie">abouclie</option>
	</select>
	<br><br>
	<strong>🤟 Inutiles❗ :</strong><br>
	<select onchange="selectLogin(this.value)">
	  <option value="">-- Choisir un inutile --</option>
	  <option value="vdurand">yalaatik</option>
	  <option value="vdurand">vdurand</option>
	  <option value="arocca">arocca</option>
	</select>
  </div>
  
  <div style="text-align:center;">
    <input type="text" id="login" placeholder="ex: pledieu">
    <button onclick="fetchLogtime()">Afficher</button>
  </div>
  <div id="results"></div>
  <script>
    function toggleTheme() {
      const body = document.body;
      body.classList.toggle('dark');
      body.classList.toggle('light');
      const isDark = body.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      document.querySelector('.toggle-theme').textContent = isDark ? '🌙' : '☀️';
    }

    (function () {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
        document.querySelector('.toggle-theme').textContent = '☀️';
      }
    })();

    function selectLogin(login) {
      document.getElementById("login").value = login;
      fetchLogtime();
    }

    async function fetchLogtime() {
      const login = document.getElementById("login").value;
      const results = document.getElementById("results");
      results.innerHTML = "⏳ Chargement...";

      try {
        const res = await fetch(`https://logtime-web.onrender.com/logtime?login=${login}`);
        const data = await res.json();

        if (data.error) {
          results.innerHTML = "❌ Erreur : " + data.error;
		} else {
			const monthlyGoalSeconds = data.monthly_goal_hours * 3600.0;
			const percent = Math.min(100, Math.round((data.month_raw / monthlyGoalSeconds) * 100));
			const weeklyGoal = data.weekly_goal_hours;

			results.innerHTML = `
				<h3>📊 Résultat pour <strong>${login}</strong></h3>
				<p>📅 Aujourd'hui : ${data.today}</p>
				<p>📆 Cette semaine : ${data.week} <br><small>⏳ Reste : ${data.remaining_week} | 🎯 Objectif : ${weeklyGoal}h</small></p>
				<p>🗓️ Ce mois : ${data.month} <br><small>⏳ Reste : ${data.remaining_month}</small></p>

				<div class="progress-container">
				<div class="progress-bar" style="width:${percent}%;">${percent}%</div>
				</div>
				<p>🎯 Objectif mensuel : ${data.monthly_goal_hours}h</p>
			`;
		}
      } catch (e) {
        results.innerHTML = "❌ Erreur de requête : " + e;
      }
    }
  </script>
</body>
</html>
